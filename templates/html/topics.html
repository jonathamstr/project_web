<!DOCTYPE html>
<html lang="en">
<!--Random-->
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
    <meta name="description" content="">
    <meta name="author" content="">

    <title>Maison du code: Apprennez a developper le future</title>

    <!-- Bootstrap core CSS -->
    <link href="/static/dist/css/bootstrap.min.css" rel="stylesheet">

    <!-- IE10 viewport hack for Surface/desktop Windows 8 bug -->
    <link href="/static/assets/css/ie10-viewport-bug-workaround.css" rel="stylesheet">

    <!-- Just for debugging purposes. Don't actually copy these 2 lines! -->
    <!--[if lt IE 9]><script src="../../assets/js/ie8-responsive-file-warning.js"></script><![endif]-->
    <script src="/static/assets/js/ie-emulation-modes-warning.js"></script>

    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->

    <!-- Custom styles for this template -->
    <link href="/static/css/carousel.css" rel="stylesheet">
    <link href="/static/css/theme.css" rel="stylesheet">
    <link href="/static/css/publication.css" rel="stylesheet">
  </head>
<!-- NAVBAR
================================================== -->
  <body>
<!--    <div class="navbar-wrapper"> -->
<!--      <div class="container"> -->

        <div class="navbar navbar-inverse navbar-fixed-top">
          <div class="container">
            <div class="navbar-header">
              <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
              </button>
              <a class="navbar-brand" href="/">Maison du code</a>
            </div>
            <div id="navbar" class="navbar-collapse collapse">
              <ul class="nav navbar-nav">
                <li><a href="/">Principal</a></li>
                <li class="active"><a href="/topics">Topics</a></li>
                <li><a href="/groups">Group</a></li>
                <li class="dropdown">
                  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">Dropdown <span class="caret"></span></a>
                  <ul class="dropdown-menu">
                    <li><a href="#">Action</a></li>
                    <li><a href="#">Another action</a></li>
                    <li><a href="#">Something else here</a></li>
                    <li role="separator" class="divider"></li>
                    <li class="dropdown-header">Nav header</li>
                    <li><a href="#">Separated link</a></li>
                    <li><a href="#">One more separated link</a></li>
                  </ul>
                </li>
              </ul>

            <!--  <form class="navbar-form navbar-right" action="/login" method="POST">
                {% if logged %}
                <p>
                  Salut!
               </p>
               {% else %}
                <div class="form-group">
                  <input type="text" placeholder="Email" class="form-control" name="Email">
                </div>
                <div class="form-group">
                  <input type="password" placeholder="Password" class="form-control">
                </div>
                <button type="submit" class="btn btn-success">Entré</button>
              {% endif %}
              </form>
            -->
            {% if logged %}
          <form class="navbar-form navbar-right" action="/logout">
          <a href="/profile"> {{ message }} </a>
           <button type="submit" class="btn btn-danger">Sortir</button>
         </form>
           {% else %}
            <form class="navbar-form navbar-right" action="/login" method="POST">
            <!--  <div class="form-group">
                <input type="text" placeholder="Email" class="form-control">
              </div>
              <div class="form-group">
                <input type="password" placeholder="Password" class="form-control">
              </div>
              <button type="submit" class="btn btn-success">Entré</button>
            -->
            <div class="form-group">
              <input type="text" placeholder="Email" class="form-control" name="Email">
            </div>
            <div class="form-group">
              <input type="password" placeholder="Password" class="form-control">
            </div>

            <button type="submit" class="btn btn-success">Entré</button></form>

            <form class="navbar-form navbar-right" action="/signin">
            <button type="submit" class="btn btn-success">Sign in</button>
            </form>
            {% endif %}
            </div>
          </div>
        </div>

  <!--    </div> -->
  <!--  </div> -->


	<div class="container main-container">
      <!--<div class="form-group">
        <form action="/pub" method="POST">
	<h3>Nouvelle Publication</h3>
  <label for="title">Titre de la publication</label>
  <input type="text" class="form-control" placeholder="Titre" name="Titre">
  <label for="Corps">Mettre l'information</label>
  <textarea type="text" class="form-control" placeholder="Texte de la publication" rows="3" name="Corps"></textarea>
    <textarea class="form-control" rows="3"></textarea> -->
 <!--	<br>
     <button class="btn btn-lg btn-primary btn-block" type="submit">Publier</button>
   </form>
 </div>-->
  <h3>Topics</h3>
  <div id="searchTopics">

  </div>
<div class="form-group">
      <h3>Search</h3>
      <label for="search">Topic</label>
      <input type="text" class="form-control" placeholder="Topic" name="nameTopic" id="nameTopic">
      <button class="btn btn-primary" id="sTopic">Search</button>
</div>

  <div class="container">
    	<div class="divider">
        <h2>Search Results</h2>

      </div>
      <table class="table table-hover" id="table-publications">
        <tr><th>Titre</th><th>Utilisateur</th><th>Date</th></tr>
        {% for i in pubs %}
        <tr id={{i.cle_pub}}><td>{{i.publication.titre}}</td><td>{{ i.publication.cle_util }}</td><td> {{ i.publication.date }}</td></tr>
        {% endfor %}
      </table>
        <button id="plus" type="submit" class="btn btn-success">Afficher plus</button>
        {% if pubs %}
        <button id="moins" type="submit" class="btn btn-danger">Afficher moins</button>
        {% endif %}
      <!-- FOOTER -->
      <footer>
        <p class="pull-right"><a href="#">Back to top</a></p>
        <p>&copy; 2015 Company, Inc. &middot; <a href="#">Privacy</a> &middot; <a href="#">Terms</a></p>
      </footer>

    </div><!-- /.container -->


    <!-- Bootstrap core JavaScript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
    <script>window.jQuery || document.write('<script src="/static/assets/js/vendor/jquery.min.js"><\/script>')</script>
    <script src="/static/dist/js/bootstrap.min.js"></script>
    <!-- Just to make our placeholder images work. Don't actually copy the next line! -->
    <script src="/static/assets/js/vendor/holder.min.js"></script>
    <!-- IE10 viewport hack for Surface/desktop Windows 8 bug -->
    <script src="/static/assets/js/ie10-viewport-bug-workaround.js"></script>
    <script type="text/javascript" src="/static/js/useangular.js"></script>
    <script>
      $(document).ready(function(){
        $SCRIPT_ROOT = {{ request.script_root|tojson|safe }};

        function askServer(root,callFunc){
          $SCRIPT_ROOT = {{ request.script_root|tojson|safe }};
          $.getJSON($SCRIPT_ROOT + root ,function(data){
          callFunc(data);
          });
        }

        function postServer(root,info){
          $SCRIPT_ROOT = {{ request.script_root|tojson|safe }};
          $.getJSON($SCRIPT_ROOT + root ,{
              message: info
          });
        }

        function askServer(root,info,callFunc){
          $SCRIPT_ROOT = {{ request.script_root|tojson|safe }};
          $.getJSON($SCRIPT_ROOT + root ,{
            message: info
          },function(data){
          callFunc(data);
        });
      }
      var addTopic = function() {
        if($(this).parents('div').attr("id") == "searchTopics"){
        selectTopics.push($(this).attr("id"));
        $("#topics").append($(this));
        postServer('/upTopics',$(this).attr("id"));
        //alert($(this).parents('div').attr("id"));
      }
      else{
       var pos = selectTopics.indexOf($(this).attr("id"));
        selectTopics.splice(pos,1);
       $("#addTopics").append($(this));
       postServer('/downTopics',$(this).attr("id"));
      }
      };

      var removeTopic = function(){
         var pos = selectTopics.indexOf($(this).attr("id"));
         selectTopics.splice(pos,1);
        $("#addTopics").append($(this));
        postServer('/downTopics',$(this).attr("id"));
      //  alert(selectTopics);
      //  alert(selectTopics.indexOf($(this).attr("id")));
      $(this).click(addTopic);
      };

        var changeTopics = function(data){
            $("#searchTopics").empty();
          for(var i of data.ches){
              var topicButton = $("<a></a>").attr({
                "class":"btn btn-default notAdded",
                "type":"submit",
                "id": i.name_top,
                href:"/topics/"+i.cle_top
              }).html(i.name_top);
              topicButton.text(i.name_top);
              topicButton.click(addTopic);
              $("#searchTopics").append(topicButton);
          }
        };


        askServer('/searchTopics',"",changeTopics);
        //askServer('/getutil','Hello!!!!!!!!!!!!!!!!!!!!!!!!',priting);
        /*$SCRIPT_ROOT = {{ request.script_root|tojson|safe }};
        $.getJSON($SCRIPT_ROOT + '/getutil', {
            message: "{{ message }}"
        },function(data){
          alert(data.ches);
        });
        */
      /*  $.getJSON($SCRIPT_ROOT + '/getTopTopics' ,function(data){
          alert(data.ches[0].name_top);
        }); */

        /*Fucntion to search for a topic to add to the Publication*/
        $("#sTopic").click(function(){
          askServer("/searchTopics",$("#nameTopic").val(),function(data){
            changeTopics(data);
            var alreadyCreated = false;
            for(var i of data.ches){
              if(i.name_top == $("#nameTopic").val() ) alreadyCreated = true;
            }
            //alert(data.ches.indexOf($("#nameTopic").val()));
            if(!alreadyCreated ){
              $("#cTopic").removeClass('disabled');
            }
            else{
              $("#cTopic").addClass('disabled');
            }
          });
        });
        /*Function to create a new Topic*/
      /*$("#sTopic").click(askServer("/searchTopics",$("#nameTopic").val(),function(data){
        $("#addTopics").empty();
        for(var i of data.ches){
          if(!selectTopics[i.name_top]){
            var topicButton = $("<button></button>").attr({
              "class":"btn btn-default notAdded",
              "type":"submit",
              "id": i.name_top
            }).html(i.name_top);
            topicButton.text(i.name_top);
            topicButton.click(addTopic);
            $("#addTopics").append(topicButton);
          }
        }
      }));*/
        $("tr").click(function(){
          //alert('Something')
          if( typeof $(this).attr('id') !== 'undefined'){
          var iden = "/posting/"+$(this).attr("id");
          //window.document.location =iden;
           window.location.href = iden;
         }
        });

        $('#plus').click(function(){
          $SCRIPT_ROOT = {{ request.script_root|tojson|safe }};
          $.getJSON($SCRIPT_ROOT + '/change', {
              valeur: {{ valeur }} + 10
          });
          window.location.href = '/';
        });
        $('#moins').click(function(){
          $SCRIPT_ROOT = {{ request.script_root|tojson|safe }};
          $.getJSON($SCRIPT_ROOT + '/change', {
              valeur: {{ valeur }} - 10
          });
          window.location.href = '/';
        });
      });
    </script>

  </body>
</html>
